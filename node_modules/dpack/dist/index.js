!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define([],r):"object"==typeof exports?exports.dpack=r():e.dpack=r()}(window,function(){return function(e){var r={};function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(n,o,function(r){return e[r]}.bind(null,o));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./browser.js")}({"./browser.js":
/*!********************!*\
  !*** ./browser.js ***!
  \********************/
/*! no static exports found */function(e,r,t){var n=t(/*! ./lib/serialize */"./lib/serialize.js"),o=t(/*! ./lib/parse */"./lib/parse.js"),i=t(/*! ./lib/Options */"./lib/Options.js").Options;r.serialize=n.serialize,r.parse=o.parse,r.createSerializer=n.createSerializer,r.createParser=o.createParser,r.Options=i,r.fetch=t(/*! ./fetch */"./fetch.js").fetch,r.XMLHttpRequest=t(/*! ./xhr */"./xhr.js").XMLHttpRequest},"./fetch.js":
/*!******************!*\
  !*** ./fetch.js ***!
  \******************/
/*! no static exports found */function(e,r,t){"use strict";var n=t(/*! ./lib/parse */"./lib/parse.js").createParser;t(/*! ./lib/serialize */"./lib/serialize.js").serialize;function o(e,r){var t=e.body.getReader();return new Promise(function(e,r){var o,i,a;function s(e){var r=e.length,t=r-1;if(e[t]<128)return a=null,e;for(;t>=0;){var n=e[t];if(n>=192){var o=(n>=224?n>=240?4:3:2)-r+t;return o>0?((a=e.slice(t,r-t)).needs=o,e.slice(0,t)):(a=null,e)}t--}return a=null,e}var u=new TextDecoder;!function f(){t.read().then(function(t){if(t.done)e(i);else try{var c,l=t.value;if(a?(c=u.decode(new Uint8Array(Array.from(a).concat(Array.from(l.slice(0,a.needs))))),l=s(l=l.slice(a.needs)),c+=u.decode(l)):(l=s(l),c=u.decode(l)),o){if(o.onResume){var d=o.onResume(c,!0);i=i||d}}else(o=n()).setSource(c,0,!0),i=o.read();o.read(),f()}catch(e){r(e)}},r)}()})}r.readResponse=o,r.fetch=function(e,r){(r.headers||(r.headers={})).Accept="text/dpack;q=1,application/json;q=0.7";var t=fetch(e,r);return t.then(function(e){return e.dpack=function(r){return o(e)},e}),t}},"./lib/Options.js":
/*!************************!*\
  !*** ./lib/Options.js ***!
  \************************/
/*! no static exports found */function(e,r,t){"use strict";function n(){this.classByName=new Map;this.converterByConstructor=new Map}n.prototype.addExtension=function(e,r,t){r&&e.name!==r&&(e.name=r),this.classByName.set(e.name,t&&t.fromArray?t:e),this.converterByConstructor.set(e,t&&t.toArray?t:e)},r.Options=n},"./lib/parse.js":
/*!**********************!*\
  !*** ./lib/parse.js ***!
  \**********************/
/*! no static exports found */function(e,r,t){"use strict";var n=3,o=4,i=6,a=7,s=8,u=9,f=11,c=13,l=14,d=500,p=12,y=14,h=15;function v(e){var r,t,v;e||(e={});var w,j,S,k=e.classByName||new Map;function P(e,n){if(e.previous=w,e.resume=!0,w=e,!v)throw new Error("Unexpected end of dpack stream");return T.onResume||(T.onResume=function(e,o,i){var a=w;return w=null,T.onResume=null,t=n<t.length?t.slice(n)+e:i?e.slice(0,1)+e.slice(1):e,v=o,z+=n,r=0,a.reader?a.reader(a):x(a.length,a)}),e.object}function x(v,g){var b,m,S,z=0,O=0,A=0;if((g=g||[]).resume){if(b=g.previous){var V=b.reader?b.reader(b):x(b.length,b);(B=b.values)&&(w?w.values=B:V.nextPosition>-1?B[B.nextPosition++]=V:B.push(V))}g.code&&g.code!==g.thisProperty.code?g.resume=!1:(O=g.i||0,S=g.object,z=g.propertyState||0,A=g.propertyIndex||0,g=g.thisProperty)}for(m=g.code===a,S=S||(g.constructs?new g.constructs:m?[]:{});O<v;){var R,E,M=r,q=t.charCodeAt(r++);if(q>=48)q>12288?(R=q>>>12^4,E=4095&q):(R=q>>>4^4,E=15&q);else if(R=q>>>4&11,E=((E=15&q)<<6)+(63&(q=t.charCodeAt(r++))),!(q>=64||(E=(E<<6)+(63&(q=t.charCodeAt(r++))),q>=64||(E=(E<<6)+(63&(q=t.charCodeAt(r++))),q>=64||(E=(E<<6)+(63&(q=t.charCodeAt(r++))),q>=64||(E=64*E+(63&(q=t.charCodeAt(r++))),q>=64||(E=64*E+(63&(q=t.charCodeAt(r++))),q>=64||(E=64*E+(63&(q=t.charCodeAt(r++))),q>=0||!(r>t.length)))))))))return P({length:v,thisProperty:g,i:O,object:S,propertyIndex:A,propertyState:z},M);if(0!==R){if(b=g[A],3===R){if(!(E<6)){if(E<=u){if(1===z&&(O++,b=g[++A]),A<g.resetTo)throw new Error("Overwriting frozen property");b?b.resume||(V=b.key,(b=g[A]=[]).key=V):(b=g[A]=[]).key=null,b.code=E,b.parent=g,z=2,E===s?b.values=[]:E===a&&(b[0]=[],b[0].key=null,b[0].code=i,b[0].parent=b)}else z=E;continue}V=E<3?0===E?null:"Unknown token, type: "+R+" number: "+E:E===o||E!==n&&void 0}else if(2===R){if(V=t.slice(r,r+=E),r>t.length)return P({length:v,thisProperty:g,i:O,object:S,propertyIndex:A,propertyState:z},M);z<2&&b.code===u&&(V=+V)}else if(1===R)V=E;else if(E>13){if(E===y)return S;E===h&&(V=x(0,b),z=0,e.forDeferred?V=e.forDeferred(V,b):(j||(j=[])).push({property:b,value:V}))}else if(E>=p&&(E=2e9),z>1?2===z?(z=0,V=x(E,b)):V=z===f?x(E,[{key:null,code:6}]):b.resume&&(b.code||i)===b.thisProperty.code?x(E,b.thisProperty):x(E,b):V=x(E,b),w){if(void 0===V)return w=null,T.onResume=null,P({length:v,thisProperty:g,i:O,object:S,property:b,propertyIndex:A,previousProperty:previousProperty,propertyState:z},M);w.values=B}if(!b)throw new Error("No property defined for slot"+(g.key?" in "+g.key:""));if(z<2&&b&&b.code===s){var B=b.values;if("number"==typeof V){if(void 0===(V=B[E])&&!(E in B))throw new Error("Referencing value that has not been read yet")}else 2!==R&&7!==R||!B||(B.nextPosition>-1?(b.recordValueReference&&b.recordValueReference(B),B[B.nextPosition++]=V):B.push(V))}if(z>1){if(2===z)b.key=V;else if(z===f)if("string"==typeof V){var U=k.get(V);if(U)U.fromValue?b.fromValue=U.fromValue:b.constructs=U;else if(e.errorOnUnknownClass)throw new Error("Attempt to deserialize to unknown class "+parameter);b.extendedType=U}else b.metadata=V,V===d&&(b.fromValue=C);else if(z===c){(B=b.values||(b.values=[])).nextPosition=V}else if(z!==l)throw new Error("Unknown property type "+z);z=1}else z=0,b.fromValue&&(V=b.fromValue(V)),m&&null===b.key?S.push(V):void 0!==V&&(S[b.key]=V),O++,m||A++}else A=E,z=0}return S}function C(r){if(!e.onError)throw S=!0,r;e.onError(r)}k.set("Map",g),k.set("Set",b),k.set("Date",m);var z=0;var T={setSource:function(e,n,o){return t=e,r=n||0,z=0,v=o,this},hasMoreData:function(){return t.length>r},isPaused:function(){return w},hasUnfulfilledReferences:function(){return j&&j.length>j.index},getOffset:function(){return r+z},read:function n(o){try{if(o&&o.resume){var i=o.previous;a=x(i.length,i),a=o.object||a,o=o.property}else var a=x(1,o=o||[e&&e.shared||{key:null,code:6}])[o[0].key];for(;;){if(w)return P({reader:n,object:a,property:o});if(!j)return a;var s=j.index||0,u=j[s];if(j.index=s+1,u){var f=u.value,c=j;(j=[]).parent=c;var l=u.property,d=x(1,o=[{resume:!0,key:null,thisProperty:l,object:f}]);(d=d.null||d[l.key])!=f&&(Object.assign(f,d),w&&w.object===d&&(w.object=f),d&&d.constructor===Array&&(f.length=d.length,Object.setPrototypeOf(f,Object.getPrototypeOf(d))))}else j=j.parent}}catch(e){throw S||(e.message="DPack parsing error: "+e.message+" at position: "+(r+z)+" near: "+t.slice(r-10,r+10)),e}}};return T}r.parse=function(e,r){var t;if("string"==typeof e)t=e;else{if(!e||!e.toString)return e;t=e.toString(r&&r.encoding||"utf8")}var n=v(r).setSource(t);return r&&r.shared?n.read([r.shared]):n.read()},r.createParser=v;var g={fromValue:function(e){for(var r=new Map,t=0,n=e.length;t<n;t++){var o=e[t];r.set(o.key,o.value)}return r}},b={fromValue:function(e){var r=new Set(e);if(0===r.size&&e.length>0)for(var t=0,n=e.length;t<n;t++)r.add(e[t]);return r}},m={fromValue:function(e){return new Date(e)}}},"./lib/serialize.js":
/*!**************************!*\
  !*** ./lib/serialize.js ***!
  \**************************/
/*! no static exports found */function(e,r,t){"use strict";(function(e){var t=0,n=3,o=2,i=1,a=7,s=0,u=3,f=4,c=5,l=6,d=7,p=8,y=9,h=11,v=13,g=500,b=12,m=14,w=15,j=1;function S(S){S||(S={});var k=S.converterByConstructor;k||(k=new Map),k.set(Map,{name:"Map",toValue:P}),k.set(Set,{name:"Set",toValue:x}),k.set(Date,{name:"Date",toValue:C});S.outlet||S.avoidShareUpdate;var z,T=void 0===e||!e.Buffer||S&&"utf16le"===S.encoding?function(){var e="";function r(r,t){var n;if(t<16)n=String.fromCharCode(64^(r<<4|t));else if(t<1024)n=String.fromCharCode((r<<4)+(t>>>6),64+(63&t));else if(t<65536)n=String.fromCharCode((r<<4)+(t>>>12),t>>>6&63,64+(63&t));else if(t<4194304)n=String.fromCharCode((r<<4)+(t>>>18),t>>>12&63,t>>>6&63,64+(63&t));else if(t<268435456)n=String.fromCharCode((r<<4)+(t>>>24),t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<4294967296)n=String.fromCharCode((r<<4)+(t>>>30),t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<17179869184)n=String.fromCharCode((r<<4)+(t/1073741824>>>0),t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else if(t<1099511627776)n=String.fromCharCode((r<<4)+(t/68719476736>>>0),t/1073741824&63,t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t));else{if(!(t<70368744177664))throw new Error("Too big of number");n=String.fromCharCode((r<<4)+(t/4398046511104>>>0),t/68719476736&63,t/1073741824&63,t>>>24&63,t>>>18&63,t>>>12&63,t>>>6&63,64+(63&t))}e+=n}return{writeToken:r,writeString:function(r){e+=r},getSerialized:function(){return e},startSequence:function(){r(a,b)},endSequence:function(){r(a,m)},getOffset:function(){return-1}}}():r.nodeCharEncoder(S),O=T.writeString,A=T.writeToken,V=T.startSequence,R=T.endSequence,E=T.writeBuffer;S.forProperty;S.shared&&(z=S.shared.propertyUsed,S.shared.propertyUsed);var M,q=[],B=r.bufferSymbol||"_bufferSymbol_",U=r.targetSymbol||"_targetSymbol_",_=j++,D=[0,1,2,3,4,5,N,F,L,W,function(){A(n,s)}];function H(e){A(o,e.length),O(e)}function L(e){var r,t=M.values;if(t){t.resetTo>-1&&t.serializer!==_&&(t.serializer=_,t.resetTo<t.length&&(t.length=t.resetTo),A(n,v),A(i,t.resetTo));var o=t.indexOf(e);if(o>-1)return function(e){A(i,e)}(o)}if("string"==(r=typeof e)||"object"===r&&e)if(M.writeSharedValue){if(M.writeSharedValue(e,A,_))return}else if(t){var a=t.length;a<12&&(t[a]=e)}"string"===r?H(e):N(e)}function W(e){var r=typeof e;"number"===r?e>>>0===e||e>0&&e<70368744177664&&e%1==0?A(i,e):H(e.toString()):"object"===r?N(e):I(e)}function I(e){null===e?A(n,s):!1===e?A(n,u):!0===e?A(n,f):void 0===e?A(n,c):function(e){var r,t=typeof e;if("object"===t)if(e){var o=e.constructor;if(o===Object);else if(o===Array)t="array";else if((r=k.get(o))&&r.toValue){if(e=r.toValue(e),t=typeof e,e&&"object"===t&&e.constructor===Array&&(t="array"),M.type===t)return M.extendedType!==r&&(M.extendedType=r,A(n,h),H(r.name)),D[M.code](e)}else r=!1}else t="undefined";else"boolean"===t?t="undefined":"function"===t&&(e=e.toString(),t="string");M=X(null,t,r),D[M.code](e)}(e)}function N(e,r){var o=typeof e;if("object"!==o)return"string"===o?H(e):"number"===o&&(e>>>0===e||e>0&&e<70368744177664&&e%1==0)?A(i,e):I(e);if(!e)return A(n,s);var u,f=e,c=f.constructor;if(f[U])return G(e);if(c===Object)u=!1;else{if(c===Array)return M=X(M.key,"array"),D[M.code](e,r);if(f.then)return G(e);if(g=k.get(c)){if(g.toValue)return I(f)}else k.set(c,g={name:c.name});M.constructs!==c&&(A(n,h),H(g.name),M.constructs=c),"undefined"!=typeof Symbol&&f[Symbol.iterator]&&(X(M.key,"array"),function(e){A(a,15);var r,t=e[Symbol.iterator](),n=M;M=n.child||(n.child=n);for(;!(r=t.next()).done;)D[M.code](r.value,n);M!==n.child&&(n.child=M);M=n,A(a,m)}(f)),u=!0}var l=M;l.resetTo<l.length&&l.serializer!=_&&(l.length=l.resetTo,l.serializer=_),V();var d=0,p=-2,y=0;for(var v in f)if(!u||f.hasOwnProperty(v)){o=typeof(e=f[v]),M=l[y];var g=!1;if("object"===o&&(e?(c=e.constructor)===Object||(c===Array?o="array":(g=k.get(c))&&g.toValue?(o=typeof(e=g.toValue(e)),e&&"object"===o&&e.constructor===Array&&(o="array")):g=!1):o="undefined"),!M||M.key!==v||M.type!==o&&"boolean"!==o&&"undefined"!==o&&("string"!==o||"number"===M.type)||g&&M.extendedType!==c){var b=y;p>-2&&(y=p);do{M=l[++y]}while(M&&(M.key!==v||M.type!==o&&"boolean"!==o&&"undefined"!==o&&("string"!==o||"number"===M.type)||g&&M.extendedType!==c));if(M)A(t,y),-2===p&&(p=b-1);else if(l.getProperty)b!==(y=(M=l.getProperty(e,v,o,g,X,A,b)).index)&&-2===p&&(p=b-1);else{if(b===l.length?y=b:(A(t,y=l.length),-2===p&&(p=b-1)),y<l.resetTo)throw new Error("overwriting frozen property");M=l[y]=X(v,o,g)}}z&&z(M,f,_,d);var w=M.code;w>7?8===w?L(e):W(e):6===w?N(e):F(e),y++,d++}M=l,R(d)}function X(e,r,t){var o;return(o=[]).key=e,o.type=r,"string"===r?(A(n,p),o.values=[],o.code=p):"number"===r?(A(n,y),o.code=y):"object"===r?(A(n,l),o.code=l):"array"===r?(A(n,d),o.code=d):"boolean"===r||"undefined"===r?(o.type="object",A(n,l),o.code=l):(A(n,l),o.code=10,console.error("Unable to write value of type "+r)),"string"==typeof e?H(e):(null!==e||"object"!==r&&"array"!==r)&&N(e),t&&(o.extendedType=t,A(n,h),H(t.name)),o}function F(e,r){if(e){if(e[U])return G(e);if(e.constructor===Array){var n,o=e.length;o>11?(A(a,b),n=!0):A(a,o);var i=M;M=i[0],i.resetTo<i.length&&i.serializer!=_&&(i.length=i.resetTo,i.serializer=_);for(var s=0,u=0;u<o;u++){var f=e[u],c=typeof f;if("object"===c)if(f){var d=f.constructor;if(d===Object);else if(d===Array)c="array";else{var p=k.get(d);p&&p.toValue?(c=typeof(f=p.toValue(f)),f&&"object"===c&&f.constructor===Array&&(c="array")):p=!1}}else c="undefined";if(M){if(M.type!==c&&"boolean"!==c&&"undefined"!==c&&("string"!==c||"number"===M.type)||p&&M.extendedType!==d){s=-1;do{M=i[++s]}while(M&&(M.type!==c&&"boolean"!==c&&"undefined"!==c&&("string"!==c||"number"===M.type)||p&&M.extendedType!==d));M?A(t,s):i.getProperty?M=i.getProperty(f,null,c,p,X,A,-1):(A(t,s),M=X(null,c,p),i[s]=M)}}else i.getProperty?M=i.getProperty(f,null,c,p,X,A,0):("string"===c||"number"===c||"array"===c?M=X(null,c,p):((M=[]).type=c,M.key=null,M.code=l),i[0]=M);z&&z(M,e,_,u);var y=M.code;y>7?8===y?L(f):W(f):6===y?N(f):F(f)}n&&A(a,m),M=i}else I(e)}else I(e)}function G(e,r){A(a,w);var t=M,o=e[U]?{then:s}:{then:function(r){return e.then(function(t){e=t,s(r)},function(o){e=Object.assign(new("object"==typeof o&&o?o.constructor:Error),{name:o&&o.name,message:o&&o.message||o}),t.upgrade||(A(n,h),A(i,g)),s(r)})}};function s(r){if(S.forBlock)S.forBlock(e,t);else{var n=e&&e[B]&&e[B](t);if(n)E(n);else{M=t;var o=q;q=[],N(e),o.unshift.apply(o,q),q=o}}r()}q.push(o)}var J={serialize:function(e,r){var t=e&&e[B]&&e[B](r);t?T.writeBuffer(t):r?D[(M=r).code](e):((M=[]).key=null,N(e))},getSerialized:function(){if(q.length>0){for(var e=[];q.length>0;){var r=!1,t=q.shift().then(function(){r=!0});r||e.push(t)}if(e.length>0)return Promise.all(e).then(function(){return J.getSerialized()})}return S&&"utf16le"===S.encoding?Buffer.from(T.getSerialized(),"utf16le"):T.getSerialized()},flush:T.flush,setOffset:T.setOffset,pendingEncodings:q,getWriters:function(){return{writeProperty:X,writeToken:A,writeAsDefault:N,writeBuffer:E}}};return J}r.serialize=function(e,t){var n,o=S(t),i=t&&t.shared;i&&i.startWrite&&i.startWrite(t.avoidShareUpdate,e),o.serialize(e,i),n=o.getSerialized(),i&&i.endWrite&&i.endWrite(t.avoidShareUpdate,e);var a=e&&e[r.sizeTableSymbol];return a&&(n.sizeTable=a),t&&t.lazy?Buffer.concat([e[r.sizeTableSymbol],n]):n},r.createSerializer=S;var k=Array.from||function(e,r){var t=[];r=e.constructor===Map;return e.forEach(function(e,n){r?t.push([n,e]):t.push(e)}),t};function P(e){for(var r=k(e),t=0,n=r.length;t<n;t++){var o=r[t];r[t]={key:o[0],value:o[1]}}return r}function x(e){return k(e)}function C(e){return e.getTime()}}).call(this,t(/*! ./../node_modules/webpack/buildin/global.js */"./node_modules/webpack/buildin/global.js"))},"./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */function(e,r){var t;t=function(){return this}();try{t=t||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(t=window)}e.exports=t},"./xhr.js":
/*!****************!*\
  !*** ./xhr.js ***!
  \****************/
/*! no static exports found */function(e,r,t){"use strict";var n=t(/*! ./lib/parse */"./lib/parse.js").createParser;r.XMLHttpRequest=function(){var e,r,t=new XMLHttpRequest;t.addEventListener("progress",s);var o=t.setRequestHeader,i=0;t.setRequestHeader=function(e,t){return"accept"==e.toLowerCase()&&(r=!0),o.call(this,e,t)};var a=t.send;function s(r){var o=t.responseText;try{if(e){if(e.onResume){var a=e.onResume(o.slice(i),!0,!0);t.responseParsed=t.responseParsed||a}}else{if(!o||!/dpack/.test(t.getResponseHeader("Content-Type")))return;(e=n()).setSource(o,0,!0),t.responseParsed=e.read()}i=o.length}catch(e){if(!t.onerror)throw e;t.onerror(e)}}return t.send=function(){r||this.setRequestHeader("Accept","text/dpack;q=1,application/json;q=0.7"),a.apply(this,arguments)},t.addEventListener("load",function(r){if(s(),e&&e.isPaused())throw new Error("Unexpected end of dpack stream")}),t}}})});
//# sourceMappingURL=index.js.map